version: "3.6"

x-deploy:
  &default-deploy
  restart_policy:
    condition: on-failure
    delay: 5s
    max_attempts: 3
    window: 120s

# ============================================================================ #

services:
  pureftp:
    image: stilliard/pure-ftpd:hardened
    container_name: pure-ftpd
    ports:
      - "21:21"
      - "30000-30009:30000-30009"
    volumes:
      # make sure you actually create these:
      - "/home/pure-ftpd/ftpusers:/home/ftpusers"
      - "/home/pure-ftpd/passwd:/etc/pure-ftpd/passwd"
    environment:
      # set IP of your docker host as PUBLICHOST in commandline or UI
      # PUBLICHOST: "<DOCKER_HOST_IP_GOES_HERE>"
      FTP_USER_NAME: "ftpuser"
      FTP_USER_PASS: "ftpuser"
      FTP_USER_HOME: "/home/ftpusers"
      FTP_MAX_CLIENTS: "50"
    deploy:
      << : *default-deploy
      replicas: 1
      placement:
        constraints:
          - "node.role == manager"
